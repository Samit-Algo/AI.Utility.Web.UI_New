@page
@model EBMeterReading.Web.UI.Pages.auth.resetpasswordModel
@{
    Layout = null;
    ViewData["Title"] = "Reset Password - EB Meter Admin";
}

<!DOCTYPE html>
<html lang="en-US" dir="ltr">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>@ViewData["Title"]</title>
    <link href="~/assets/css/theme.min.css" rel="stylesheet" />
    <link href="~/assets/css/user.min.css" rel="stylesheet" />
</head>
<body>
    <main class="main" id="top">
        <div class="container-fluid bg-body-tertiary">
            <div class="row flex-center position-relative min-vh-100 g-0 py-5">
                <div class="col-11 col-sm-10 col-xl-6">
                    <div class="card border border-translucent auth-card">
                        <div class="card-body p-4 p-md-6">
                            <div class="text-center mb-6">
                                <div class="d-flex align-items-center justify-content-center mb-4">
                                    <img src="~/assets/img/icons/logo.png" alt="EB" width="40" />
                                    <h4 class="ms-2 mb-0 text-body-emphasis">EB Meter Admin</h4>
                                </div>
                                <h3 class="text-body-highlight">Reset Password</h3>
                                <p class="text-body-tertiary mb-0">Enter your email to receive reset instructions</p>
                            </div>

                            <div id="resetForm">
                                <form id="emailForm">
                                    <div class="mb-4">
                                        <label class="form-label" for="email">Email Address</label>
                                        <input class="form-control" id="email" type="email" placeholder="Enter your registered email" />
                                    </div>
                                    
                                    <button class="btn btn-primary w-100 mb-4" type="submit">
                                        <span class="fas fa-paper-plane me-2"></span>Send Reset Link
                                    </button>
                                </form>

                                <div class="text-center">
                                    <span class="fs-9 fw-bold">Remember your password? </span>
                                    <a class="link-primary fs-9 fw-bold" href="@Url.Page("/auth/login")">Back to Login</a>
                                </div>

                                <div class="alert alert-info mt-4">
                                    <div class="d-flex align-items-center">
                                        <span class="fas fa-info-circle me-2"></span>
                                        <div>
                                            <strong>Demo Mode:</strong><br>
                                            <small>Password reset is simulated. Use email: <strong>admin@demo.com</strong></small>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div id="successMessage" class="text-center" style="display: none;">
                                <div class="mb-4">
                                    <div class="avatar avatar-xl bg-success text-white rounded-circle mx-auto mb-3">
                                        <span class="fas fa-check fs-4"></span>
                                    </div>
                                    <h4 class="text-body-emphasis mb-2">Check Your Email</h4>
                                    <p class="text-body-secondary mb-4">
                                        We've sent password reset instructions to your email address.
                                    </p>
                                    <div class="alert alert-success">
                                        <p class="mb-2"><strong>Demo Instructions:</strong></p>
                                        <p class="mb-2">Your temporary reset code is: <strong class="text-primary">DEMO123</strong></p>
                                        <p class="mb-0">Use this code below to continue.</p>
                                    </div>
                                </div>

                                <form id="codeForm">
                                    <div class="mb-3">
                                        <label class="form-label" for="resetCode">Reset Code</label>
                                        <input class="form-control text-center" id="resetCode" type="text" placeholder="Enter reset code" />
                                    </div>
                                    <div class="row g-3 mb-4">
                                        <div class="col-md-6">
                                            <label class="form-label" for="newPassword">New Password</label>
                                            <input class="form-control" id="newPassword" type="password" placeholder="New password" />
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label" for="confirmNewPassword">Confirm Password</label>
                                            <input class="form-control" id="confirmNewPassword" type="password" placeholder="Confirm new password" />
                                        </div>
                                    </div>
                                    <button class="btn btn-success w-100 mb-3" type="submit">
                                        <span class="fas fa-key me-2"></span>Reset Password
                                    </button>
                                </form>

                                <div class="text-center">
                                    <button class="btn btn-link fs-9" id="backToEmail">Didn't receive email? Try again</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="~/vendors/bootstrap/bootstrap.min.js"></script>
    <script src="~/vendors/fontawesome/all.min.js"></script>

    <script>
        $(document).ready(function() {
            // Pre-fill demo email
            $('#email').val('admin@demo.com');

            // Handle email form submission
            $('#emailForm').submit(function(e) {
                e.preventDefault();
                
                const email = $('#email').val().trim();
                
                if (!email || !isValidEmail(email)) {
                    showAlert('Please enter a valid email address.', 'danger');
                    return;
                }

                // Demo validation - only accept demo email
                if (email !== 'admin@demo.com') {
                    showAlert('Email not found. Please use admin@demo.com for demo.', 'danger');
                    return;
                }

                const submitBtn = $(this).find('button[type="submit"]');
                const originalText = submitBtn.html();
                submitBtn.html('<span class="spinner-border spinner-border-sm me-2"></span>Sending...').prop('disabled', true);

                setTimeout(() => {
                    $('#resetForm').hide();
                    $('#successMessage').show();
                    $('#resetCode').val('DEMO123'); // Pre-fill for demo
                }, 1500);
            });

            // Handle reset code form submission
            $('#codeForm').submit(function(e) {
                e.preventDefault();
                
                const code = $('#resetCode').val().trim();
                const newPassword = $('#newPassword').val();
                const confirmPassword = $('#confirmNewPassword').val();

                if (code !== 'DEMO123') {
                    showResetAlert('Invalid reset code. Please use DEMO123.', 'danger');
                    return;
                }

                if (!newPassword || newPassword.length < 6) {
                    showResetAlert('Password must be at least 6 characters long.', 'danger');
                    return;
                }

                if (newPassword !== confirmPassword) {
                    showResetAlert('Passwords do not match.', 'danger');
                    return;
                }

                const submitBtn = $(this).find('button[type="submit"]');
                submitBtn.html('<span class="spinner-border spinner-border-sm me-2"></span>Resetting...').prop('disabled', true);

                setTimeout(() => {
                    showResetAlert('Password reset successful! Redirecting to login...', 'success');
                    setTimeout(() => {
                        window.location.href = '@Url.Page("/auth/login")';
                    }, 2000);
                }, 1500);
            });

            // Back to email form
            $('#backToEmail').click(function() {
                $('#successMessage').hide();
                $('#resetForm').show();
                $('#emailForm button[type="submit"]').html('<span class="fas fa-paper-plane me-2"></span>Send Reset Link').prop('disabled', false);
            });

            // Email validation
            function isValidEmail(email) {
                return email.includes() && email.includes('.');
            }

            // Show alert for email form
            function showAlert(message, type) {
                $('#emailForm .alert:not(.alert-info)').remove();
                const alertHtml = '<div class="alert alert-' + type + ' alert-dismissible fade show mt-3">' + message + '<button type="button" class="btn-close" data-bs-dismiss="alert"></button></div>';
                $('#emailForm').prepend(alertHtml);
            }

            // Show alert for reset form
            function showResetAlert(message, type) {
                $('#codeForm .alert').remove();
                const alertHtml = '<div class="alert alert-' + type + ' alert-dismissible fade show mt-3">' + message + '<button type="button" class="btn-close" data-bs-dismiss="alert"></button></div>';
                $('#codeForm').prepend(alertHtml);
            }
        });
    </script>
</body>
</html>